<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <meta name="viewport" content="width=300px, initial-scale=1.0">
    <link rel="stylesheet" href="../../static/css/base.css">
    <link rel="stylesheet" href="../../static/css/profile.css">
    <title>MashMusic</title>
</head>

<header>
    <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="/">MashMusic</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto ml-5">
                <li class="nav-item">
                    <a class="nav-link sas" href="AudioService/">Playlists</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/profile">Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contacts</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/login">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/registration">Sign-up</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<body>
    <form>
        <div class="form-group">
            <label for="exampleInputEmail1">Change Username</label>
            <input type="username" id="username" class="form-control" id="exampleInputEmail1"
                placeholder="New Username">
        </div>
        <div class="form-group">
            <label for="exampleInputEmail1">Change password</label>
            <input type="password" class="form-control" id="old_password" placeholder="Old password">
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="new_password" placeholder="New password">
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="repeat_password" placeholder="Repeat new password">
        </div>
        <button type="submit" class="btn" onclick="myFunction(); return false;">Save</button>

    </form>
</body>

<footer>
    <div class="container pb-2">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12 text-left mb-4 mt-4"><a href="#">Questions? Contact us.</a></div>

            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">FAQ</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Investor Relations</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Privacy</a> </div>

            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Speed Test</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Help Center</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Corporate Information</a> </div>

            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Contact Us</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left"><a href="#">Terms of Use</a> </div>
            <div class="col-md-4 col-sm-6 col-xs-12 text-left mb-3"><a href="#">Account</a> </div>
        </div>
    </div>
</footer>

<!-- <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->
<script type="text/javascript">
    var data;

    function httpGet(callback) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", 'http://127.0.0.1:8000/profile/get_username_info/', true); // true for asynchronous
        xmlHttp.send(null);
    }

    function get_response(server_response) {
        data = JSON.parse(server_response);
        document.getElementById('username').value = data['username'];
    }
    httpGet(get_response);

    function myFunction() {
        var csrftoken = '{{ csrf_token }}';
        username = document.getElementById("username").value;
        old_password = document.getElementById("old_password").value;
        new_password = document.getElementById("new_password").value;
        repeat_password = document.getElementById("repeat_password").value;

        if (new_password != repeat_password) {
            alert('Passwords dont match');
        }

        data = JSON.stringify({
            username: username,
            old_password: old_password,
            new_password: new_password,
        });
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                xmlHttp.responseText;
        }

        xmlHttp.open("POST", "http://127.0.0.1:8000/profile/change_info/")
        xmlHttp.setRequestHeader("X-CSRFToken", csrftoken);
        xmlHttp.send(data);
    }
</script>

</html>